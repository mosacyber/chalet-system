generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER
  OWNER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  BLOCKED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String         @unique
  phone         String?
  password      String
  role          Role           @default(OWNER)
  image         String?
  ownedChalets  Chalet[]       @relation("OwnedChalets")
  bookings      Booking[]
  reviews       Review[]
  notifications Notification[]
  linkPage      LinkPage?      @relation("UserLinkPage")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Chalet {
  id            String    @id @default(cuid())
  slug          String    @unique
  ownerId       String?
  owner         User?     @relation("OwnedChalets", fields: [ownerId], references: [id])
  nameAr        String
  nameEn        String
  descriptionAr String    @db.Text
  descriptionEn String    @db.Text
  images        String[]
  amenities     String[]
  capacity      Int
  bedrooms      Int
  bathrooms     Int
  pricePerNight Decimal   @db.Decimal(10, 2)
  weekendPrice  Decimal?  @db.Decimal(10, 2)
  locationAr    String
  locationEn    String
  latitude      Float?
  longitude     Float?
  isActive       Boolean        @default(true)
  bookings       Booking[]
  reviews        Review[]
  waterExpenses  WaterExpense[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Booking {
  id         String        @id @default(cuid())
  userId     String
  user       User          @relation(fields: [userId], references: [id])
  chaletId   String
  chalet     Chalet        @relation(fields: [chaletId], references: [id])
  checkIn    DateTime
  checkOut   DateTime
  guests     Int
  totalPrice Decimal       @db.Decimal(10, 2)
  status     BookingStatus @default(PENDING)
  notes           String?       @db.Text
  guestName       String?
  guestPhone      String?
  paymentMethod   String?
  deposit                Decimal?      @db.Decimal(10, 2)
  remainingAmount        Decimal?      @db.Decimal(10, 2)
  remainingPaymentMethod String?
  remainingCollected     Boolean       @default(false)
  payment                Payment?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Payment {
  id        String        @id @default(cuid())
  bookingId String        @unique
  booking   Booking       @relation(fields: [bookingId], references: [id])
  amount    Decimal       @db.Decimal(10, 2)
  currency  String        @default("SAR")
  method    String
  status    PaymentStatus @default(PENDING)
  stripeId  String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  chaletId  String
  chalet    Chalet   @relation(fields: [chaletId], references: [id])
  rating    Int
  comment   String   @db.Text
  isVisible Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, chaletId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  titleAr   String
  titleEn   String
  messageAr String
  messageEn String
  type      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model WaterExpense {
  id        String   @id @default(cuid())
  chaletId  String
  chalet    Chalet   @relation(fields: [chaletId], references: [id])
  amount    Decimal  @db.Decimal(10, 2)
  notes     String?
  date      DateTime @default(now())
  createdAt DateTime @default(now())
}

model LinkPage {
  id              String     @id @default(cuid())
  userId          String     @unique
  user            User       @relation("UserLinkPage", fields: [userId], references: [id])
  slug            String     @unique
  displayName     String
  subtitle        String?
  bio             String?    @db.Text
  avatarUrl       String?
  themeColor      String     @default("#10b981")
  backgroundStyle String     @default("flat")
  buttonStyle     String     @default("rounded")
  fontFamily      String     @default("default")
  isPublished     Boolean    @default(false)
  links           LinkItem[]
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

model LinkItem {
  id         String   @id @default(cuid())
  linkPageId String
  linkPage   LinkPage @relation(fields: [linkPageId], references: [id], onDelete: Cascade)
  title      String
  url        String
  iconType   String   @default("link")
  linkType   String   @default("link")
  sortOrder  Int      @default(0)
  isActive   Boolean  @default(true)
  isFeatured Boolean  @default(false)
  thumbnail  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([linkPageId])
}

model SiteSetting {
  id    String @id @default(cuid())
  key   String @unique
  value String @db.Text
}

model Visit {
  id        String   @id @default(cuid())
  page      String
  referrer  String?
  userAgent String?
  ip        String?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([page])
}
